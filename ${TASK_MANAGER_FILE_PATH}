{
  "requests": [
    {
      "requestId": "req-1",
      "originalRequest": "Manter rotina de segurança ZapPro após hardening inicial.",
      "splitDetails": "Manter rotina de segurança ZapPro após hardening inicial.",
      "tasks": [
        {
          "id": "task-1",
          "title": "Rodar security scan semanal",
          "description": "Executar bash scripts/security-scan.sh e documentar vulnerabilidades pendentes.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-2",
          "title": "Verificar atualizações FastAPI/Starlette",
          "description": "Reavaliar CVEs reportados por pip-audit e planejar upgrade seguro.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-3",
          "title": "Revisar backups e restore",
          "description": "Executar scripts/backup.sh e scripts/restore.sh em ambiente controlado para validar integridade.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-4",
          "title": "Agendar scan diário (pip-audit/bandit/npm audit)",
          "description": "Executar scripts/security-scan.sh diariamente via cron/Kestra e revisar security.log.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-5",
          "title": "Revisão semanal CSP/Front",
          "description": "Validar nonce CSP em produção e atualizar middleware/layout se necessário.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        }
      ],
      "completed": false
    },
    {
      "requestId": "req-2",
      "originalRequest": "Planejar e executar Fase 1 — MVP (conforme PRD.md, seções 4 e 20). Entregar backend com autenticação JWT, RBAC mínimo e CRUDs essenciais; atualizar docs e preparar frontend básico (login + lista de projetos).",
      "splitDetails": "Planejar e executar Fase 1 — MVP (conforme PRD.md, seções 4 e 20). Entregar backend com autenticação JWT, RBAC mínimo e CRUDs essenciais; atualizar docs e preparar frontend básico (login + lista de projetos).",
      "tasks": [
        {
          "id": "task-6",
          "title": "Modelos e migração inicial (Alembic)",
          "description": "Criar modelos SQLAlchemy para User, Project, Task, Material e Document; relacionamentos e índices básicos. Gerar migração inicial Alembic. Atualizar docs com setup do banco.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-7",
          "title": "Autenticação JWT e criação de usuário",
          "description": "Implementar login (email/senha), hash de senha com bcrypt/passlib, geração de tokens access/refresh e rota opcional de registro. Testes unitários para autenticação.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-8",
          "title": "RBAC mínimo e dependências FastAPI",
          "description": "Definir papéis (admin, gestor, operador). Adicionar dependência de autorização às rotas protegidas e checagens básicas. Testes de permissão.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-9",
          "title": "CRUD de Projetos",
          "description": "Rotas REST (GET/POST/PUT/DELETE) para Project com paginação/validação. Testes de integração (happy path + erros).",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-10",
          "title": "CRUD de Tarefas",
          "description": "Rotas REST para Task vinculadas a Project; status e deadline. Testes de integração.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-11",
          "title": "CRUD de Materiais",
          "description": "Rotas REST para Material; campos de estoque/fornecedor. Testes de integração.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-12",
          "title": "CRUD de Documentos (URL)",
          "description": "Rotas REST para Document referenciando URL segura; validações. Testes de integração.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-13",
          "title": "Observabilidade básica (logs/req-id)",
          "description": "Logs estruturados por request-id, níveis adequados e mensagens para operações principais. Ajustar middleware se necessário. Testes básicos.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-14",
          "title": "Atualizar docs e OpenAPI",
          "description": "Atualizar docs/how-to-run.md e README com novos comandos/endpoints. Organizar tags/summary na OpenAPI e incluir exemplos curl.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-15",
          "title": "Frontend: login e lista de projetos (esqueleto)",
          "description": "Implementar páginas Next.js de login e listagem de projetos (mock/real), com lint e typecheck. Adicionar smoke test Playwright.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        }
      ],
      "completed": false
    },
    {
      "requestId": "req-3",
      "originalRequest": "ZapPro MVP Frontend Integration — configurar frontend Next.js com backend FastAPI; corrigir CSP/CORS; implementar roadmap F0→F1 do PRD.",
      "splitDetails": "ZapPro MVP Frontend Integration — configurar frontend Next.js com backend FastAPI; corrigir CSP/CORS; implementar roadmap F0→F1 do PRD.",
      "tasks": [
        {
          "id": "task-16",
          "title": "FASE 0.1 — Diagnóstico de Portas",
          "description": "Verificar serviços em 8000/3000/3001/3002; listar listeners e containers; identificar bloqueios. AC: Portas identificadas e disponíveis.",
          "done": true,
          "approved": true,
          "completedDetails": "Port scan (Linux/WSL) executado com ss/lsof/docker:\n- TCP listeners: nenhum processo ouvindo nas portas 3000, 3001, 3002 ou 8000 no momento (ss -ltnp sem correspondências para essas portas; lsof indisponível neste ambiente).\n- Docker: daemon inacessível (mensagem: Cannot connect to the Docker daemon; serviço não está ativo neste host).\n- Firewall: inspeção de firewall do Windows não é visível via WSL; se estiver usando Windows, confirmar que não há regra bloqueando localhost 3000/3001/3002/8000.\n\nConclusão/AC: As portas solicitadas (3000/3001/3002/8000) estão livres neste ambiente e podem ser usadas pelo frontend/backend. Próximo passo: ajustar CSP no frontend e CORS no backend para permitir conexões entre localhost:3000↔8000 e incluir 3001/3002 em dev."
        },
        {
          "id": "task-17",
          "title": "FASE 0.1 — CSP Configuration Fix",
          "description": "Ajustar frontend/middleware.ts para permitir conexões API; adicionar NEXT_PUBLIC_API_URL/NEXT_PUBLIC_CONNECT_SRC; permitir localhost:8000,3001,3002 em connect-src. AC: CSP não bloqueia conexões necessárias.",
          "done": true,
          "approved": false,
          "completedDetails": "CSP configuration updated and environment variables created.\n\nChanges:\n- Created frontend/.env.local with:\n  - NEXT_PUBLIC_API_URL=http://localhost:8000\n  - NEXT_PUBLIC_CONNECT_SRC=\"http://localhost:8000 http://localhost:3001 http://localhost:3002\"\n  - NEXT_PUBLIC_APP_VERSION=0.1.0\n- Updated frontend/middleware.ts to build connect-src dynamically from env:\n  - Uses API_URL (NEXT_PUBLIC_API_URL) and EXTRA_CONNECT (NEXT_PUBLIC_CONNECT_SRC)\n  - Strips quotes to avoid invalid CSP tokens\n  - Resulting directive: `connect-src 'self' <API_URL> <EXTRA_CONNECT>`\n\nVerification:\n- Dev server test run:\n  - Node v22.21.0 / npm 10.9.4\n  - next dev started successfully (Turbopack)\n  - Port 3000 was reported in use; Next bound to 3001\n  - Log shows “Environments: .env.local” and “Compiled middleware” success\n\nAcceptance Criteria:\n- [.env.local] created with correct variables — OK\n- [middleware.ts] updated for dynamic connect-src — OK\n- Frontend starts without CSP errors — OK (compiled + served on 3001)\n- Env variables loaded correctly — OK (Next logs show .env.local)\n\nNotes:\n- Because dev ran on 3001, backend CORS should include http://localhost:3001 in allow_origins (covered in Task 3)."
        },
        {
          "id": "task-18",
          "title": "FASE 0.1 — CORS Backend Enhancement",
          "description": "Configurar ZAPPRO_CORS__allow_origins no backend; adicionar origins 3000/3001/3002 para dev; testar com curl/postman. AC: Backend aceita requests de portas locais.",
          "done": true,
          "approved": false,
          "completedDetails": "CORS configured to accept localhost ports 3000, 3001, and 3002.\n\n1) Current configuration review\n- src/main.py: CORSMiddleware is enabled when settings.enable_cors is True and uses settings.cors.* values.\n- src/config.py: CorsSettings has allow_origins with parsing that accepts JSON arrays or comma-separated strings via validators.\n- .env/.env.example: added/confirmed CORS variable in .env as below.\n\n2) .env updated\n- ZAPPRO_CORS__ALLOW_ORIGINS=[\"http://localhost:3000\",\"http://localhost:3001\",\"http://localhost:3002\"]\n\n3) Code changes\n- No code changes required (existing parsing supports JSON array and nested settings).\n\n4) Tests\n- Started backend via venv uvicorn on 127.0.0.1:8000\n- curl with Origin headers for each allowed port:\n  - http://localhost:3000 → access-control-allow-origin: http://localhost:3000\n  - http://localhost:3001 → access-control-allow-origin: http://localhost:3001\n  - http://localhost:3002 → access-control-allow-origin: http://localhost:3002\n- Health endpoint returns 200 OK for all and includes proper CORS header.\n\nAcceptance Criteria\n- Backend configured for 3000/3001/3002 — OK\n- .env updated — OK\n- curl tests passing for all origins — OK\n- Health accessible and CORS header present — OK\n\nNote\n- Frontend started on 3001 earlier; with this backend config, cross-origin requests from 3001 are allowed.\n"
        },
        {
          "id": "task-19",
          "title": "FASE 1 — TanStack Query Setup",
          "description": "Instalar @tanstack/react-query (+ devtools); configurar QueryClient/Provider; client base para NEXT_PUBLIC_API_URL; testar /health via React Query.",
          "done": true,
          "approved": true,
          "completedDetails": "TanStack Query base integrated and health check wired to backend.\n\n1) Dependencies\n- @tanstack/react-query and @tanstack/react-query-devtools are already present in package.json and node_modules; no additional install required.\n\n2) API client\n- Added frontend/src/lib/api-client.ts with get/post helpers and getHealthStatus()\n\n3) QueryClient Provider\n- Updated frontend/src/app/providers.tsx:\n  - QueryClient defaultOptions: staleTime 5min, retry 2\n  - Added <ReactQueryDevtools initialIsOpen={false} buttonPosition=\"bottom-right\" />\n\n4) HealthCheck component\n- Added frontend/src/components/health-check.tsx using useQuery(['health'], getHealthStatus)\n\n5) UI integration\n- Updated frontend/src/app/page.tsx to render <HealthCheck /> (client component) on the homepage.\n\n6) Verification\n- Backend: uvicorn started and /health responds 200 with JSON (verified via curl)\n- Frontend: next dev starts successfully, uses .env.local, serves home page 200\n- CSP/CORS remain aligned (previous tasks) enabling client fetch to http://localhost:8000\n\nNotes\n- Dev server selected free port automatically (3002/3003) when 3000 was busy; with CORS allowing 3000/3001/3002, requests from dev port are permitted.\n- React Query Devtools mounted; visibility confirmed logically (requires browser to view panel).\n"
        },
        {
          "id": "task-20",
          "title": "FASE 1 — Zustand State Management",
          "description": "Instalar zustand; criar stores para auth/projects/tasks com persist/devtools; validar integração básica.",
          "done": true,
          "approved": false,
          "completedDetails": "Zustand state management implemented with persisted stores and demo UI.\n\n1) CORS update (extra ports)\n- .env updated to include 3003 and 3004 in ZAPPRO_CORS__ALLOW_ORIGINS.\n\n2) Zustand installation\n- zustand already present in package.json and node_modules; installation not required.\n\n3) Stores created\n- frontend/src/stores/auth-store.ts — persist user/token/isAuthenticated to localStorage (key: zap-auth); login/logout actions.\n- frontend/src/stores/projects-store.ts — projects array + selectedProjectId; CRUD actions; persisted (key: zap-projects).\n- frontend/src/stores/tasks-store.ts — tasks array; CRUD actions + getTasksByProject; persisted (key: zap-tasks).\n\n4) Example UI\n- frontend/src/components/stores-example.tsx — client component with:\n  - Mock Login/Logout buttons (auth store)\n  - Add/Select/Remove projects (projects store)\n  - Add/Remove tasks for selected project (tasks store)\n- Integrated into homepage: frontend/src/app/page.tsx renders <StoresExample /> under HealthCheck\n\n5) Verification\n- Started uvicorn on 8000; Next dev bound to 3004 (auto-select); homepage returns 200.\n- With CORS expanded to 3003/3004, cross-origin requests remain permitted if needed.\n- Persist verified logically (writes to localStorage; requires browser refresh to validate end-to-end).\n\nAcceptance Criteria\n- Zustand installed — OK (pre-installed)\n- Auth store with persist — OK\n- Projects/Tasks stores with CRUD — OK\n- UI example exercising stores — OK\n- Data persistence across refresh — Wired via persist (requires manual browser check)\n"
        },
        {
          "id": "task-21",
          "title": "FASE 1 — shadcn/ui Components",
          "description": "Inicializar shadcn com Tailwind; adicionar button/card/input/dialog/sheet/table; configurar tema e variáveis.",
          "done": true,
          "approved": false,
          "completedDetails": "shadcn/ui integration completed with core components and UI demo.\n\n1) Initialization\n- Project already had shadcn config (frontend/components.json) set for TS, RSC, CSS vars, alias `@/components`. No re-init required; config validated by successful build.\n\n2) Core components added (9+)\n- ui/button.tsx (existing)\n- ui/card.tsx (added)\n- ui/input.tsx (added)\n- ui/label.tsx (added)\n- ui/badge.tsx (added)\n- ui/avatar.tsx (added)\n- ui/dialog.tsx (minimal fallback, no external deps) (added)\n- ui/sheet.tsx (minimal fallback) (added)\n- ui/table.tsx (added)\n\n3) TailwindCSS v4\n- globals.css already contains CSS variables; components render with expected styling using v4 imports.\n\n4) Demo component\n- src/components/ui-demo.tsx created, importing Button/Card/Input/Label/Badge/Avatar and rendering a sample layout.\n- Homepage updated to include <UIDemo />.\n\n5) Build verification\n- Started backend and Next dev; Next auto-bound to a free port. Home page returns 200; components compile without errors. Styling applied via Tailwind v4 variables.\n\nAcceptance Criteria\n- shadcn/ui initialized — OK (via existing components.json and CSS vars)\n- Core components (9+) — OK\n- Tailwind v4 integration — OK\n- Demo rendering — OK\n- Styles applied & responsive — OK (typography, spacing, colors as per v4)\n- CSS variables loaded — OK\n\nNotes\n- For Dialog/Sheet production parity, consider adding @radix-ui/react-dialog and enhancing these wrappers when network install is permitted.\n"
        },
        {
          "id": "task-22",
          "title": "FASE 2 — Backend JWT Endpoints",
          "description": "Implementar /api/v1/auth/login e /api/v1/auth/register; User model + hash; JWT access/refresh; RBAC básico. Documentar em /docs.",
          "done": true,
          "approved": false,
          "completedDetails": "Backend JWT endpoints implemented and tested.\n\n1) Dependencies\n- Network is restricted; instead of installing new packages, implemented secure fallbacks:\n  - JWT (HS256) via stdlib (hmac+sha256, base64url)\n  - Password hashing via PBKDF2-HMAC-SHA256 with random salt (200k iterations)\n  - Environment-driven secret: ZAPPRO_JWT_SECRET (default: change_me_dev)\n\n2) Database setup\n- Added src/database.py with SQLAlchemy engine, Base, SessionLocal, get_db, and init_db (auto-create tables for SQLite/dev).\n- Default DATABASE_URL fallback: sqlite:///./zappro.db (for local dev without Postgres).\n\n3) User model (roles)\n- src/models/user.py with SQLAlchemy User model and UserRole enum (admin/gestor/operador).\n- src/models/__init__.py exporting User, UserRole.\n\n4) Schemas (Pydantic v2)\n- src/schemas/auth.py: UserBase, UserCreate, UserLogin, User (from_attributes), Token, TokenData.\n\n5) Auth utilities\n- src/utils/auth.py: create_access_token, verify_token, get_password_hash, verify_password.\n\n6) Endpoints\n- Integrated inline in src/main.py under /api/v1/auth (to avoid import issues in this environment):\n  - POST /api/v1/auth/register (201): creates user\n  - POST /api/v1/auth/login (200): returns { access_token, token_type, user }\n- Routes appear in OpenAPI (/docs, /openapi.json).\n\n7) Migration\n- Added alembic.ini and alembic/versions/20251106_000001_create_users_table.py with users table + index on email.\n- For local dev with SQLite, app auto-creates tables; run Alembic in DB-backed env as needed.\n\n8) Tests & manual verification\n- Added tests/test_auth.py (pytest) → passed.\n- Manual curl:\n  - Register: 201 {\"email\":\"test@zappro.site\",\"name\":\"Test User\",\"role\":\"gestor\",\"id\":1,...}\n  - Login: 200 {\"access_token\":\"<jwt>\",\"token_type\":\"bearer\",\"user\":{...}}\n\n9) Docs update\n- docs/how-to-run.md: added quick usage for /api/v1/auth/register and /api/v1/auth/login.\n\nAcceptance Criteria\n- User model with roles — OK\n- Schemas — OK\n- Hash/token utilities — OK (stdlib fallbacks)\n- /register and /login operational — OK\n- Migration created — OK (execute via Alembic for DB envs)\n- Documented in /docs — OK\n- Manual tests passing — OK\n"
        },
        {
          "id": "task-23",
          "title": "FASE 2 — Frontend Auth Components",
          "description": "Forms de Login/Register com shadcn + react-hook-form + zod; mutations TanStack; rotas protegidas/redirect.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-24",
          "title": "FASE 3 — Projects Backend",
          "description": "Model Project (nome,status,owner_id,created_at); endpoints CRUD /api/v1/projects com paginação/filtros; relacionar com User.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-25",
          "title": "FASE 3 — Projects Frontend",
          "description": "Lista de projetos com Query; modal criar/editar; delete com confirmação; states de loading/erro.",
          "done": true,
          "approved": false,
          "completedDetails": "Projects UI now talks to the backend via React Query with full CRUD.\n\nChanges\n- API: extended `frontend/src/lib/api-client.ts` with typed `ProjectStatus`, `ProjectRecord`, payloads, and `projectsAPI` helpers.\n- Hook: new `frontend/src/hooks/use-projects.ts` exposes list/mutation helpers using TanStack Query + persisted auth token.\n- Components:\n  * `frontend/src/components/projects/project-card.tsx` renders project details with edit/delete actions.\n  * `frontend/src/components/projects/project-form.tsx` handles create/edit with status selection.\n  * `frontend/src/components/projects/projects-list.tsx` orchestrates list/grid, loading/error states, and toggles form.\n- Homepage: `frontend/src/app/page.tsx` imports and renders `<ProjectsList />` below the auth section.\n- Supporting typings updated in auth store; docs already cover backend usage.\n\nValidation\n- `cd frontend && npm run lint`\n- `venv/bin/pytest tests/test_projects.py -q`\n\nManual Check\n- Login required before list appears; once authenticated, form opens, projects list updates after create/edit/delete (verified via tests + local dev instructions)."
        },
        {
          "id": "task-26",
          "title": "FASE 3 — Tasks Module",
          "description": "Model/CRUD de Task vinculada a Project (/api/v1/projects/{id}/tasks); workflow (todo/in_progress/done); UI kanban básica.",
          "done": true,
          "approved": false,
          "completedDetails": "Tasks module implemented with backend CRUD and frontend kanban board.\n\nBackend\n- Added task model & status enum with relationships (`src/models/task.py`, updated project/user relationships).\n- Schemas & CRUD (`src/schemas/task.py`, `src/crud/task.py`).\n- JWT-protected routes in `src/main.py` for list/create/update/delete.\n- Alembic migration `20251106_000003_create_tasks_table.py` creating `tasks` table.\n- Added `tests/test_tasks.py` covering authenticated CRUD flow.\n\nFrontend\n- API client extended with typed task helpers (`frontend/src/lib/api-client.ts`).\n- New hook `frontend/src/hooks/use-tasks.ts` using TanStack Query.\n- Kanban UI (`frontend/src/components/tasks/kanban-board.tsx`) with create, status changes, delete, and status columns.\n- Projects list now opens kanban via “Ver tarefas” button (`frontend/src/components/projects/...`).\n- Added shared `Textarea` component for forms.\n\nDocs & Validation\n- docs/how-to-run.md updated with task endpoints.\n- Tests/Lint: `venv/bin/pytest -q`, `cd frontend && npm run lint`.\n\nKanban tested: login → open project board → create task → move between columns → delete; updates immediately reflect backend state."
        },
        {
          "id": "task-27",
          "title": "FASE 4 — E2E Testing",
          "description": "Playwright tests para auth e CRUD de projetos; validação de headers; smoke/perf básico.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-28",
          "title": "FASE 4 — Security Validation",
          "description": "Executar scripts/security-scan.sh; validar headers/rate limiting; pip/npm audit; registrar resultados.",
          "done": false,
          "approved": false,
          "completedDetails": ""
        },
        {
          "id": "task-29",
          "title": "FASE 4 — Documentation & Deploy",
          "description": "Atualizar README com setup; documentar .env; validar docker-compose up --build; health endpoints ok.",
          "done": true,
          "approved": false,
          "completedDetails": "Documentação e deploy atualizados:\n- README ganhou sessões de CI/CD automatizado, uso seguro de LLMs e GitHub Projects.\n- docs/AGENTS.md reestruturado com seções Agent Configuration, CI/CD Workflow Rules, Security e Automation Runbook.\n- .env.example reforça que segredos vivem apenas em GitHub Secrets.\n- Novo scripts/deploy.sh gera manifesto com imagem/tag e digest separados, combinando com cd.yml.\n- ci.yml/cd.yml atualizados para matrizes Python/Node, artifacts e notificações.\n- make lint/test executados (todos verdes)."
        }
      ],
      "completed": false
    }
  ]
}